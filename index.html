<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing Api</title>
</head>

<body>
    <h1>Testing Mock Calendar api</h1>
    <button onclick="Init()">Press me!</button>
    <div id="events">

    </div>
    <script>
        let event1 = {
            'summary': '4th of July',
            'location': 'Park',
            'description': 'Fireworks in the park!',
            'start': {
                'date': '2023-07-04'
            },
            'end': {
                'date': '2023-07-04'
            },
            'status': 'confirmed',
            'attendees': [
                { 'email': 'king1@middleearth.com' },
                { 'email': 'king2@middleearth.com' }
            ],
            'reminders': {
                'useDefault': true
            }
        };
        let event2 = {
            'summary': 'Intern Meeting',
            'location': 'Zoom',
            'description': 'Join in to talk about your internship',
            'start': {
                'dateTime': '2023-06-30T10:00:00-07:00',
                'timeZone': 'America/Los_Angeles'
            },
            'end': {
                'dateTime': '2023-06-30T12:00:00-07:00',
                'timeZone': 'America/Los_Angeles'
            },
            'attendees': [
                { 'email': 'intern@gmail.com' },
                { 'email': 'intern2@gmail.com' }
            ],
            'reminders': {
                'useDefault': true
            }
        };
        let errorMessage = {
            'success': false,
            'error': 'invalid info'
        }
        const events = [event1, event2];

        function FetchEvents(invalid) {
            if (invalid) {
                return Response.json(errorMessage);
            }
            else
                return Response.json(events);
        }

        function Init() {
            const resp = FetchEvents(true);
            resp.json()
                .then(events => {
                    if (events.error) {
                        throw new Error(events.error);
                    }
                    console.log(events);
                    const eventsContainer = document.getElementById('events');
                    eventsContainer.innerHTML = render(events);
                })
                .catch(error => {
                    alert('Error: ' + error.message);
                    console.error('Error: ', error);
                });
        }

        function render(data) {
            return (
                data.map((event, index) => (

                    RenderEvent(event, index)
                ))
            )
        }

        function RenderEvent(event, index) {
            const OPTIONS = { year: "numeric", month: "long", day: "2-digit", hour: "numeric", minute: "numeric", hc: "h12" }
            const DATEOPTIONS = { year: "numeric", month: "long", day: "2-digit", timeZone: "UTC" }
            let startDate;
            let endDate;
            if (event.start.date) {
                startDate = event.start.date;
                endDate = event.end.date;
                startDate = new Date(event.start.date).toLocaleDateString("en-US", DATEOPTIONS);
                endDate = new Date(event.end.date).toLocaleDateString("en-US", DATEOPTIONS);
            }
            else {
                startDate = event.start.dateTime;
                endDate = event.end.dateTime;
                startDate = new Date(event.start.dateTime).toLocaleDateString("en-US", OPTIONS);
                endDate = new Date(event.end.dateTime).toLocaleDateString("en-US", OPTIONS);
            }
            return `<div key=${index}>
                            <h2>${event.summary}</h2>
                            <p>Location: ${event.location}</p>
                            <p>Description: ${event.description}</p>
                            <p>Start Date: ${startDate}</p>
                            <p>End Date: ${endDate}</p>
                        </div>`;
        }
    </script>
</body>

</html>